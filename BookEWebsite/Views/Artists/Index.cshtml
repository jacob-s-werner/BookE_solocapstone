@model BookEWebsite.Models.Artist

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Index</h1>

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.FirstName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LastName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LookingForGigs)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.GroupName)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                @Html.DisplayFor(modelItem => Model.FirstName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => Model.LastName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => Model.LookingForGigs)
            </td>
            <td>
                @Html.DisplayFor(modelItem => Model.GroupName)
            </td>
            <td>
                <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
                <a asp-action="Details" asp-route-id="@Model.Id">Details</a> |
            </td>
        </tr>
    </tbody>
</table>
<div id="map_wrapper">
    <div id="map_canvas" class="mapping"></div>
</div>

<script>
    var map;
    var centerCoords = { lat: @ViewBag.SearchLocation.Latitude, lng: @ViewBag.SearchLocation.Longitude };
    var InfoObject = [];

    //var icons = {
        //    comedy: {
        //        icon: 'iconpath.png'
        //    },
        //    music: {
        //        icon: ''
        //    },
        //    sports: {
        //        icon: ''
        //    },
        //};
    window.onload = function () {
        initMap();
    }

    function initMap() {
        var map = new google.maps.Map(document.getElementById('map_canvas'), {
            center: centerCoords,
            zoom: 15
        });

        addMarkerInfo();
    }

    var markersOnMap = [
        @foreach (var business in ViewBag.BusinessMarkers) {
            <text>
            {
                placeName: '@business.Name'
                LatLng: [{ lat: @business.Address.Latitude, lng: @business.Address.Longitude }],
                type: '@business.Specialization'
            },
            </text>
            }
    ];

    function addMarkerInfo() {
        for (var i = 0; i < markersOnMap.length; i++) {
            var contentString = '<h3>' + markersOnMap[i].placeName + '</h3>'

            const marker = new google.maps.Marker({
                position: markersOnMap[i].LatLng[0],
                //  icon: icons[markersOnMap[i].type].icon,
                map: map
            });

            const infowindow = new google.maps.InfoWindow({
                content: contentString
            });

            marker.addListener('click', function () {
                closeOtherInfo();
                infowindow.open(map, marker);
                InfoObject[0] = infowindow;

            })
        }
    }

    function closeOtherInfo() {
        if (InfoObject.length > 0) {
            InfoObject[0].set("marker", null);
            InfoObject[0].close();
            InfoObject[0].length = 0;
        }
    };
</script>
<script async defer
        src='https://maps.googleapis.com/maps/api/js?key={@Secrets.GOOGLE_API_KEY}&callback=initMap'>
</script>